# üîç Forensics Integration: –£—á—ë—Ç —Ç–æ–∫–µ–Ω–æ–≤ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è, –≤–Ω–µ–¥—Ä—è—é—â–∏–µ **–ø–æ–¥—Ä–æ–±–Ω—ã–π —É—á—ë—Ç —Ä–∞—Å—Ö–æ–¥–∞ —Ç–æ–∫–µ–Ω–æ–≤** (Forensics) –≤ —Å–∏—Å—Ç–µ–º—É Nanobot.

## üìå –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

–¢–µ–ø–µ—Ä—å –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∫ LLM –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (`memory.db`) —Å —É–∫–∞–∑–∞–Ω–∏–µ–º:
*   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏
*   –ö–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–∫–µ–Ω–æ–≤ (prompt / completion / total)
*   –ü—Ä–∏–º–µ—Ä–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (USD)
*   –í—Ä–µ–º–µ–Ω–∏ –∑–∞–ø—Ä–æ—Å–∞

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### 1. `nanobot/providers/litellm_provider.py`
*   **–î–æ–±–∞–≤–ª–µ–Ω–æ:** –ò–º–ø–æ—Ä—Ç `logging` –∏ —Å–æ–∑–¥–∞–Ω–∏–µ `logger`.
*   **–ù–æ–≤—ã–π –º–µ—Ç–æ–¥:** `_track_tokens(model, usage)` ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç `add_token_usage` –∏–∑ `nanobot.memory`.
*   **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** –í –º–µ—Ç–æ–¥–µ `chat()` –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ LLM:
    ```python
    if result.usage:
        self._track_tokens(model, result.usage)
    ```
*   **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –û—à–∏–±–∫–∏ –∑–∞–ø–∏—Å–∏ –ª–æ–≥–æ–≤ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `try/except` –∏ **–Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç** –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

### 2. `nanobot/cli/commands.py`
*   **–ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞:** `nanobot usage sessions [-d N]`
    *   `nanobot usage sessions -d 1` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ —Å–µ–≥–æ–¥–Ω—è.
    *   `nanobot usage sessions -d 7` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π.

### 3. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (`~/.nanobot/memory.db`)
*   **–¢–∞–±–ª–∏—Ü–∞:** `token_usage`
*   **–ú–∏–≥—Ä–∞—Ü–∏—è:** –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è. –¢–∞–±–ª–∏—Ü–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —á–µ—Ä–µ–∑ `init_db()`.

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ `git pull`

–ß—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç:

1.  **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥:**
    –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `nanobot/providers/litellm_provider.py` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –º–µ—Ç–æ–¥ `_track_tokens` –∏ –µ–≥–æ –≤—ã–∑–æ–≤ –≤ `chat()`.

2.  **–°–¥–µ–ª–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å:**
    ```bash
    nanobot agent -m "–ü—Ä–∏–≤–µ—Ç"
    ```

3.  **–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:**
    ```bash
    nanobot usage sessions -d 1
    ```
    –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –º–æ–¥–µ–ª–∏, —Ç–æ–∫–µ–Ω–æ–≤ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏.

## üîÑ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å ModelRouter

**–í–æ–ø—Ä–æ—Å:** –ù–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç –ª–∏ —Ç—Ä–µ–∫–∏–Ω–≥ —Å —Ä–æ—É—Ç–µ—Ä–æ–º –º–æ–¥–µ–ª–µ–π?
**–û—Ç–≤–µ—Ç:** –ù–µ—Ç, –æ–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ.

**–ü—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:**
1.  **ModelRouter (–ú–µ—Ç—Ä–¥–æ—Ç–µ–ª—å):** –†–µ—à–∞–µ—Ç, *–∫–∞–∫—É—é –º–æ–¥–µ–ª—å* –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—ã–±–∏—Ä–∞–µ—Ç Qwen –≤–º–µ—Å—Ç–æ Claude).
2.  **LiteLLM Provider (–ü–æ–≤–∞—Ä):** –í—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ *–≤—ã–±—Ä–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏*.
3.  **Forensics (–ñ—É—Ä–Ω–∞–ª):** –§–∏–∫—Å–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç *–ø–æ—Å–ª–µ* –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

–§—É–Ω–∫—Ü–∏—è `_track_tokens` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è **–ø–æ—Å–ª–µ** —Ç–æ–≥–æ, –∫–∞–∫ –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω. –û–Ω–∞ –ø—Ä–æ—Å—Ç–æ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ñ–∞–∫—Ç: "–ó–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω –º–æ–¥–µ–ª—å—é **X**, –ø–æ—Ç—Ä–∞—á–µ–Ω–æ **Y** —Ç–æ–∫–µ–Ω–æ–≤". –ï–π –Ω–µ –≤–∞–∂–Ω–æ, –∫—Ç–æ –≤—ã–±—Ä–∞–ª –º–æ–¥–µ–ª—å (—Ä–æ—É—Ç–µ—Ä –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å), –æ–Ω–∞ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—Ö–æ–¥.

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è CLI

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–∞—Å—Ö–æ–¥—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è
nanobot usage sessions -d 1

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–∞—Å—Ö–æ–¥—ã –∑–∞ –Ω–µ–¥–µ–ª—é
nanobot usage sessions -d 7

# (–ë—É–¥—É—â–µ–µ) –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–µ—Å—Å–∏–∏
nanobot usage session <session_id>
```

---
*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω –≤ —Ä–∞–º–∫–∞—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Phase 3: Telemetry & Forensics.*
